# Context Enrichment Code Migration Mapping

## Overview
This document maps the code from `gen_context.py` and `generate_context.py` files to their new locations in the refactored codebase.

## Source Files
- `gen_context.py` - Advanced context enrichment with batch processing
- `generate_context.py` - Basic context enrichment (simpler version)

## Target Files and Mappings

### 1. src/preprocessing/chunk.py
**Enhanced CodeChunk model (from gen_context.py)**
- Added fields: qualified_name, location, metadata, documentation, analysis, relationships
- Enhanced __post_init__ to initialize new fields
- Maintains backward compatibility with existing CodeChunk

### 2. src/generation/prompt_constructor.py (NEW FILE)
**From gen_context.py:**
- `ContextPromptBuilder` - Abstract base class
- `MultiLanguageContextPrompt` - Advanced prompt builder with multi-language support
- `SymbolIndex` - Enhanced symbol lookup class

**From generate_context.py:**
- `DjangoCodeContextPrompt` - Django-specific prompt builder

### 3. src/generation/generator.py (ENHANCED)
**From gen_context.py:**
- `LLMClient` - Enhanced with async batch processing, OpenAI support
- Added `generate_batch()` async method for batch processing

**From generate_context.py:**
- Merged older LLMClient logic (synchronous Ollama-only)

### 4. src/generation/context_builder.py (ENHANCED)
**From gen_context.py:**
- `ContextEnricher` - Main enrichment class with async batching
- `update_summary()` - Database update utility
- `get_summarized_chunks_ids()` - Get processed chunk IDs
- `stats_check()` - Statistics printing utility

**From generate_context.py:**
- Merged simpler synchronous enrichment logic

### 5. main.py (ENHANCED)
**New CLI Command:**
- `enrich` command for CLI-based context enrichment

**New API Endpoint:**
- `POST /enrich-chunks` for API-based context enrichment

**New Imports:**
- Added imports for ContextEnricher and utility functions

## Function/Class Mappings

### gen_context.py -> New Locations:
- `Chunk` (Pydantic model) -> `CodeChunk` in `src/preprocessing/chunk.py`
- `SymbolIndex` -> `src/generation/prompt_constructor.py`
- `ContextPromptBuilder` -> `src/generation/prompt_constructor.py`
- `MultiLanguageContextPrompt` -> `src/generation/prompt_constructor.py`
- `LLMClient.generate()` -> `src/generation/generator.py` (async batch version)
- `ContextEnricher.enrich()` -> `src/generation/context_builder.py` (async batch version)
- `update_summary()` -> `src/generation/context_builder.py`
- `get_summarized_chunks_ids()` -> `src/generation/context_builder.py`
- `stats_check()` -> `src/generation/context_builder.py`

### generate_context.py -> New Locations:
- `Chunk` (Pydantic model) -> Merged into enhanced `CodeChunk`
- `SymbolIndex` -> Merged into enhanced version
- `ContextPromptBuilder` -> Merged into base class
- `DjangoCodeContextPrompt` -> `src/generation/prompt_constructor.py`
- `LLMClient` (synchronous) -> Merged into enhanced async version
- `ContextEnricher` (synchronous) -> Merged into async batch version

## Key Improvements in Refactor:
1. **Async Batch Processing** - More efficient LLM calls
2. **Unified Models** - Single enhanced CodeChunk model
3. **Better Error Handling** - Improved exception handling
4. **Database Integration** - Thread pool for DB updates
5. **CLI/API Integration** - Direct integration with main.py
6. **Multi-Provider LLM Support** - OpenAI and Ollama
7. **Incremental Processing** - Skip already processed chunks

## Usage:
- CLI: `python main.py enrich --input chunks.json --output enriched.json`
- API: `POST /enrich-chunks` with JSON payload
- Both support optional symbol index and model selection


@/chunk_processor.py  @/rag2.mermaid  and @/rag_indexing_spec.txt  along with my
directory structure move the code in the chunk_processor.py files to appropriate
files and directories and appropriate functinality taht can be called by main.py
file either through the fsatapi server or through cli-tui and now based on the changes you made
create a link between , what code form chunk_processor.py  whent into which file and save the result
into a txt file named map_chunk_processor.txt which has function to function mapping form gchunk_processor.py  to created
files and also which code in whic files were newly created.